(function () {
	var apiUrl = "http://localhost:3000/api/tiers";

	/*ReactDOM.render(
   <h3>Hello, example!</h3>,
   document.getElementById('example')
 );*/

	var findObj = function (arr, value, param) {
		var i, len;
		param = param || '_id';
		for (i = 0, len = arr.length; i < len; i++) {
			if (arr[i][param] === value) {
				return arr[i];
			}
		}
	};

	var NavEle = React.createClass({

		onClick: function (event) {
			this.props.onClick(event, this.props.id);
		},

		render: function () {
			return React.createElement(
				'li',
				{ onClick: this.onClick },
				this.props.title
			);
		}
	});

	var NavList = React.createClass({
		getInitialState: function () {
			return { cssClass: '' };
		},
		componentDidMount: function () {
			var _t = this;
			// alert(this.props.type)
			if (this.props.type === 'next' || this.props.type === 'prev') {
				setTimeout(function () {
					_t.setState({ cssClass: ' move' });
				}, 0);
			}
		},
		render: function () {
			_t = this;
			var tier = this.props.tier;

			var children = (function () {
				if (tier) {
					var childrenIds = tier.children;

					return childrenIds.map(function (id) {
						return findObj(_t.props.tiers, id);
					}).map(function (tier) {
						var onClick = function (event) {
							_t.props.onClick(event, tier._id);
						};
						return React.createElement(NavEle, { key: tier._id, onClick: onClick, id: tier._id, title: tier.title });
					});
				}
			})();

			var title = (function () {
				if (tier) {
					if (tier.parent === null) {
						return 'Menu';
					} else {
						return tier.title || '';
					}
				}
			})();

			var classes = (function () {
				if (_t.props.type === 'next') {
					return 'nextTier' + _t.state.cssClass;
				} else if (_t.props.type === 'prev') {
					return 'prevTier' + _t.state.cssClass;
				} else {
					return 'currentTier';
				}
			})();

			return React.createElement(
				'div',
				{ className: classes },
				React.createElement(
					'div',
					{ className: 'cat-tier' },
					title
				),
				React.createElement(
					'div',
					null,
					React.createElement(
						'ul',
						null,
						children
					)
				)
			);
		}
	});

	var Previous = React.createClass({
		render: function () {
			var _t = this;
			var inner = (function () {
				if (_t.props.currentTier) {
					return [React.createElement(
						'div',
						{ key: 'aaa', onClick: _t.props.goToPreviousTier },
						React.createElement('img', { src: 'images/back.png' })
					), React.createElement(
						'div',
						{ key: 'bbb', onClick: _t.props.returnToRoot },
						React.createElement('img', { src: 'images/home.png' })
					), React.createElement('div', { key: 'ccc' })];
				}
			})();

			return React.createElement(
				'div',
				{ className: 'header' },
				inner
			);
		}
	});

	var Menu = React.createClass({
		getInitialState: function () {
			return { tiers: [], currentTier: null, nextTiers: null, typeNext: null };
		},

		showNextTier: function (event, id) {
			this.setState({ typeNext: 'next' });
			this.showNewTier(event, id);
		},

		showPrevTier: function (event, id) {
			this.setState({ typeNext: 'prev' });
			this.showNewTier(event, id);
		},

		showNewTier: function (event, id) {
			var _t = this;
			var tiers = this.state.tiers;
			var currentTier = this.state.currentTier;
			var nextTier = findObj(tiers, id);

			if (nextTier.children && nextTier.children.length > 0) {
				this.setState({ nextTier: nextTier });
				setTimeout(function () {
					_t.setState({ currentTier: nextTier, nextTier: null, typeNext: null });
				}, 400);
			} else if (nextTier.href && $.trim(nextTier.href) !== '') {
				alert("end point: go to " + nextTier.href);
			} else {
				alert('end point, but href not defined');
			}
		},

		componentDidMount: function () {
			var _t = this;
			$.getJSON(this.props.json, function (data) {
				var currentTier = findObj(data.tiers, null, 'parent');
				_t.setState({ tiers: data.tiers, currentTier: currentTier, rootTier: currentTier._id });
			});
		},

		returnToRoot: function (event) {
			this.setState({ typeNext: 'prev' });
			// this.setState({currentTier:this.state.rootTier});
			this.showNewTier(event, this.state.rootTier);
		},

		goToPreviousTier: function (event) {
			// var parent = findObj(this.state.tiers,this.state.currentTier.parent);
			// this.setState({currentTier:parent});
			this.setState({ typeNext: 'prev' });
			this.showNewTier(event, this.state.currentTier.parent);
		},

		render: function () {
			var _t = this;

			var next = (function () {
				if (_t.state.nextTier) {
					return React.createElement(NavList, { type: _t.state.typeNext, tiers: _t.state.tiers, tier: _t.state.nextTier, onClick: _t.showNextTier });
				}
			})();
			return React.createElement(
				'div',
				{ id: 'nav-content-bg' },
				React.createElement(
					'div',
					null,
					React.createElement(Previous, { currentTier: this.state.currentTier, returnToRoot: this.returnToRoot, goToPreviousTier: this.goToPreviousTier }),
					React.createElement(
						'div',
						{ id: 'tierCarousel' },
						React.createElement(NavList, { type: 'currentTier', tiers: this.state.tiers, tier: this.state.currentTier, onClick: this.showNextTier }),
						next
					)
				)
			);
		}
	});

	ReactDOM.render(
	// <ul>
	// 	<NavEle name="caccona gigante"/>
	// </ul>,
	React.createElement(Menu, { json: apiUrl }), document.getElementById('nav-content'));
})();
//# sourceMappingURL=data:application/json;base64,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O01BQ3JCLG9CQUFDLE9BQU8sSUFBQyxJQUFJLEVBQUMsYUFBYSxFQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQUFBQyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQUFBQyxFQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsWUFBWSxBQUFDLEdBQUU7TUFDL0csSUFBSTtNQUNBO0tBQ0Q7SUFDRCxDQUNMO0dBQ0Y7RUFDRCxDQUFDLENBQUM7O0FBRUgsU0FBUSxDQUFDLE1BQU07Ozs7QUFJZCxxQkFBQyxJQUFJLElBQUMsSUFBSSxFQUFFLE1BQU0sQUFBQyxHQUFHLEVBQ3RCLFFBQVEsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQ3RDLENBQUE7Q0FJRCxDQUFBLEVBQUcsQ0FBQyIsImZpbGUiOiJuYXZpZ2F0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7XHJcblx0dmFyIGFwaVVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS90aWVyc1wiO1xyXG5cclxuXHQvKlJlYWN0RE9NLnJlbmRlcihcclxuXHQgIDxoMz5IZWxsbywgZXhhbXBsZSE8L2gzPixcclxuXHQgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleGFtcGxlJylcclxuXHQpOyovXHJcblxyXG5cdHZhciBmaW5kT2JqID0gZnVuY3Rpb24gKGFycix2YWx1ZSxwYXJhbSkge1xyXG5cdFx0dmFyIGksbGVuO1xyXG5cdFx0cGFyYW0gPSBwYXJhbSB8fCAnX2lkJztcclxuXHRcdGZvcihpID0gMCwgbGVuID0gYXJyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKXtcclxuXHRcdFx0aWYoYXJyW2ldW3BhcmFtXSA9PT0gdmFsdWUpe1xyXG5cdFx0XHRcdHJldHVybiBhcnJbaV07XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9O1xyXG5cclxuXHR2YXIgTmF2RWxlID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xyXG5cclxuXHRcdG9uQ2xpY2s6ZnVuY3Rpb24gKGV2ZW50KSB7XHJcblx0XHRcdHRoaXMucHJvcHMub25DbGljayhldmVudCwgdGhpcy5wcm9wcy5pZCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHJlbmRlcjpmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiAoXHJcblx0XHRcdFx0PGxpIG9uQ2xpY2s9e3RoaXMub25DbGlja30+XHJcblx0XHRcdFx0XHR7dGhpcy5wcm9wcy50aXRsZX1cclxuXHRcdFx0XHQ8L2xpPlxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgTmF2TGlzdCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcclxuXHRcdGdldEluaXRpYWxTdGF0ZTpmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHJldHVybiB7Y3NzQ2xhc3M6Jyd9O1xyXG5cdFx0fSxcclxuXHRcdGNvbXBvbmVudERpZE1vdW50OmZ1bmN0aW9uICgpIHtcclxuXHRcdFx0dmFyIF90ID0gdGhpcztcclxuXHRcdFx0Ly8gYWxlcnQodGhpcy5wcm9wcy50eXBlKVxyXG5cdFx0XHRpZih0aGlzLnByb3BzLnR5cGUgPT09ICduZXh0JyB8fCB0aGlzLnByb3BzLnR5cGUgPT09ICdwcmV2Jyl7XHJcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRfdC5zZXRTdGF0ZSh7Y3NzQ2xhc3M6JyBtb3ZlJ30pO1xyXG5cdFx0XHRcdH0sMCk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRyZW5kZXI6ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRfdCA9IHRoaXM7XHJcblx0XHRcdHZhciB0aWVyID0gdGhpcy5wcm9wcy50aWVyO1xyXG5cclxuXHJcblxyXG5cdFx0XHR2YXIgY2hpbGRyZW4gPSAoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGlmKHRpZXIpe1xyXG5cdFx0XHRcdFx0dmFyIGNoaWxkcmVuSWRzID0gdGllci5jaGlsZHJlbjtcclxuXHJcblx0XHRcdFx0XHRyZXR1cm4gY2hpbGRyZW5JZHMubWFwKGZ1bmN0aW9uIChpZCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmluZE9iaihfdC5wcm9wcy50aWVycyxpZCk7XHJcblx0XHRcdFx0XHR9KVxyXG5cdFx0XHRcdFx0Lm1hcChmdW5jdGlvbiAodGllcikge1xyXG5cdFx0XHRcdFx0XHR2YXIgb25DbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xyXG5cdFx0XHRcdFx0XHRcdF90LnByb3BzLm9uQ2xpY2soZXZlbnQsdGllci5faWQpO1xyXG5cdFx0XHRcdFx0XHR9O1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gKDxOYXZFbGUga2V5PXt0aWVyLl9pZH0gb25DbGljaz17b25DbGlja30gaWQ9e3RpZXIuX2lkfSB0aXRsZT17dGllci50aXRsZX0vPik7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pKCk7XHJcblxyXG5cdFx0XHR2YXIgdGl0bGUgPSAoZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRpZih0aWVyKXtcclxuXHRcdFx0XHRcdGlmKHRpZXIucGFyZW50ID09PSBudWxsKXtcclxuXHRcdFx0XHRcdFx0cmV0dXJuICdNZW51J1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZXtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHRpZXIudGl0bGUgfHwgJyc7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KSgpO1xyXG5cclxuXHRcdFx0dmFyIGNsYXNzZXMgPSAoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdGlmKF90LnByb3BzLnR5cGUgPT09ICduZXh0Jyl7XHJcblx0XHRcdFx0XHRyZXR1cm4gJ25leHRUaWVyJyArIF90LnN0YXRlLmNzc0NsYXNzO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmKF90LnByb3BzLnR5cGUgPT09ICdwcmV2Jyl7XHJcblx0XHRcdFx0XHRyZXR1cm4gJ3ByZXZUaWVyJyArIF90LnN0YXRlLmNzc0NsYXNzO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNle1xyXG5cdFx0XHRcdFx0cmV0dXJuICdjdXJyZW50VGllcic7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KSgpO1xyXG5cclxuXHRcdFx0cmV0dXJuIChcclxuXHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT17Y2xhc3Nlc30+XHJcblx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cImNhdC10aWVyXCI+XHJcblx0XHRcdFx0XHRcdHt0aXRsZX1cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdFx0PGRpdj5cclxuXHRcdFx0XHRcdFx0PHVsPlxyXG5cdFx0XHRcdFx0XHRcdHtjaGlsZHJlbn1cclxuXHRcdFx0XHRcdFx0PC91bD5cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHR2YXIgUHJldmlvdXMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XHJcblx0XHRyZW5kZXI6ZnVuY3Rpb24gKCkge1xyXG5cdFx0XHR2YXIgX3QgPSB0aGlzO1xyXG5cdFx0XHR2YXIgaW5uZXIgPSAoZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRpZihfdC5wcm9wcy5jdXJyZW50VGllcil7XHJcblx0XHRcdFx0XHRyZXR1cm4gKFtcclxuXHRcdFx0XHRcdFx0PGRpdiBrZXk9XCJhYWFcIiBvbkNsaWNrPXtfdC5wcm9wcy5nb1RvUHJldmlvdXNUaWVyfT5cclxuXHRcdFx0XHRcdFx0XHQ8aW1nIHNyYz1cImltYWdlcy9iYWNrLnBuZ1wiLz5cclxuXHRcdFx0XHRcdFx0PC9kaXY+LFxyXG5cdFx0XHRcdFx0XHQ8ZGl2IGtleT1cImJiYlwiIG9uQ2xpY2s9e190LnByb3BzLnJldHVyblRvUm9vdH0+XHJcblx0XHRcdFx0XHRcdFx0PGltZyBzcmM9XCJpbWFnZXMvaG9tZS5wbmdcIi8+XHJcblx0XHRcdFx0XHRcdDwvZGl2PixcclxuXHRcdFx0XHRcdFx0PGRpdiBrZXk9XCJjY2NcIj48L2Rpdj5cclxuXHRcdFx0XHRcdF0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSkoKTtcclxuXHJcblx0XHRcdHJldHVybiAoXHJcblx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJoZWFkZXJcIj5cclxuXHRcdFx0XHRcdHtpbm5lcn1cclxuXHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0KTtcclxuXHRcdH1cclxuXHR9KVxyXG5cclxuXHR2YXIgTWVudSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcclxuXHRcdGdldEluaXRpYWxTdGF0ZTpmdW5jdGlvbigpe1xyXG5cdFx0XHRyZXR1cm4ge3RpZXJzOltdLGN1cnJlbnRUaWVyOm51bGwsbmV4dFRpZXJzOm51bGwsdHlwZU5leHQ6bnVsbH07XHJcblx0XHR9LFxyXG5cclxuXHJcblx0XHRzaG93TmV4dFRpZXI6ZnVuY3Rpb24gKGV2ZW50LGlkKSB7XHJcblx0XHRcdHRoaXMuc2V0U3RhdGUoe3R5cGVOZXh0OiduZXh0J30pO1xyXG5cdFx0XHR0aGlzLnNob3dOZXdUaWVyKGV2ZW50LGlkKTtcclxuXHRcdH0sXHJcblxyXG5cdFx0c2hvd1ByZXZUaWVyOmZ1bmN0aW9uIChldmVudCxpZCkge1xyXG5cdFx0XHR0aGlzLnNldFN0YXRlKHt0eXBlTmV4dDoncHJldid9KTtcclxuXHRcdFx0dGhpcy5zaG93TmV3VGllcihldmVudCxpZCk7XHJcblx0XHR9LFxyXG5cclxuXHRcdHNob3dOZXdUaWVyOmZ1bmN0aW9uIChldmVudCxpZCkge1xyXG5cdFx0XHR2YXIgX3QgPSB0aGlzO1xyXG5cdFx0XHR2YXIgdGllcnMgPSB0aGlzLnN0YXRlLnRpZXJzO1xyXG5cdFx0XHR2YXIgY3VycmVudFRpZXIgPSB0aGlzLnN0YXRlLmN1cnJlbnRUaWVyO1xyXG5cdFx0XHR2YXIgbmV4dFRpZXIgPSBmaW5kT2JqKHRpZXJzLGlkKTtcclxuXHJcblx0XHRcdGlmKG5leHRUaWVyLmNoaWxkcmVuICYmIG5leHRUaWVyLmNoaWxkcmVuLmxlbmd0aCA+IDApe1xyXG5cdFx0XHRcdHRoaXMuc2V0U3RhdGUoe25leHRUaWVyOm5leHRUaWVyfSk7XHJcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRfdC5zZXRTdGF0ZSh7Y3VycmVudFRpZXI6bmV4dFRpZXIsIG5leHRUaWVyOm51bGwsIHR5cGVOZXh0Om51bGx9KTtcclxuXHRcdFx0XHR9LDQwMCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZihuZXh0VGllci5ocmVmICYmICQudHJpbShuZXh0VGllci5ocmVmKSAhPT0gJycpe1xyXG5cdFx0XHRcdGFsZXJ0KFwiZW5kIHBvaW50OiBnbyB0byBcIiArIG5leHRUaWVyLmhyZWYpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2V7XHJcblx0XHRcdFx0YWxlcnQoJ2VuZCBwb2ludCwgYnV0IGhyZWYgbm90IGRlZmluZWQnKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHJcblx0XHRjb21wb25lbnREaWRNb3VudDpmdW5jdGlvbiAoKSB7XHJcblx0XHRcdHZhciBfdCA9IHRoaXM7XHJcblx0XHRcdCQuZ2V0SlNPTih0aGlzLnByb3BzLmpzb24sZnVuY3Rpb24gKGRhdGEpIHtcclxuXHRcdFx0XHR2YXIgY3VycmVudFRpZXIgPSBmaW5kT2JqKGRhdGEudGllcnMsbnVsbCwgJ3BhcmVudCcpO1xyXG5cdFx0XHRcdF90LnNldFN0YXRlKHt0aWVyczpkYXRhLnRpZXJzLCBjdXJyZW50VGllcjpjdXJyZW50VGllciwgcm9vdFRpZXI6Y3VycmVudFRpZXIuX2lkfSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSxcclxuXHJcblx0XHRyZXR1cm5Ub1Jvb3Q6ZnVuY3Rpb24gKGV2ZW50KSB7XHJcblx0XHRcdHRoaXMuc2V0U3RhdGUoe3R5cGVOZXh0OidwcmV2J30pO1xyXG5cdFx0XHQvLyB0aGlzLnNldFN0YXRlKHtjdXJyZW50VGllcjp0aGlzLnN0YXRlLnJvb3RUaWVyfSk7XHJcblx0XHRcdHRoaXMuc2hvd05ld1RpZXIoZXZlbnQsdGhpcy5zdGF0ZS5yb290VGllcik7XHJcblx0XHR9LFxyXG5cclxuXHRcdGdvVG9QcmV2aW91c1RpZXI6ZnVuY3Rpb24gKGV2ZW50KSB7XHJcblx0XHRcdC8vIHZhciBwYXJlbnQgPSBmaW5kT2JqKHRoaXMuc3RhdGUudGllcnMsdGhpcy5zdGF0ZS5jdXJyZW50VGllci5wYXJlbnQpO1xyXG5cdFx0XHQvLyB0aGlzLnNldFN0YXRlKHtjdXJyZW50VGllcjpwYXJlbnR9KTtcclxuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7dHlwZU5leHQ6J3ByZXYnfSk7XHJcblx0XHRcdHRoaXMuc2hvd05ld1RpZXIoZXZlbnQsdGhpcy5zdGF0ZS5jdXJyZW50VGllci5wYXJlbnQpO1xyXG5cdFx0fSxcclxuXHJcblx0XHRyZW5kZXI6ZnVuY3Rpb24oKXtcclxuXHRcdFx0dmFyIF90ID0gdGhpcztcclxuXHJcblx0XHRcdHZhciBuZXh0ID0gKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRpZihfdC5zdGF0ZS5uZXh0VGllcil7XHJcblx0XHRcdFx0XHRyZXR1cm4gKFxyXG5cdFx0XHRcdFx0XHQ8TmF2TGlzdCB0eXBlPXtfdC5zdGF0ZS50eXBlTmV4dH0gdGllcnM9e190LnN0YXRlLnRpZXJzfSB0aWVyPXtfdC5zdGF0ZS5uZXh0VGllcn0gb25DbGljaz17X3Quc2hvd05leHRUaWVyfS8+XHJcblx0XHRcdFx0XHQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSkoKVxyXG5cdFx0XHRyZXR1cm4gKFxyXG5cdFx0XHRcdDxkaXYgaWQ9XCJuYXYtY29udGVudC1iZ1wiPlxyXG5cdFx0XHRcdFx0PGRpdj5cclxuXHRcdFx0XHRcdFx0PFByZXZpb3VzIGN1cnJlbnRUaWVyPXt0aGlzLnN0YXRlLmN1cnJlbnRUaWVyfSByZXR1cm5Ub1Jvb3Q9e3RoaXMucmV0dXJuVG9Sb290fSBnb1RvUHJldmlvdXNUaWVyPXt0aGlzLmdvVG9QcmV2aW91c1RpZXJ9Lz5cclxuXHRcdFx0XHRcdFx0PGRpdiBpZD1cInRpZXJDYXJvdXNlbFwiPlxyXG5cdFx0XHRcdFx0XHRcdDxOYXZMaXN0IHR5cGU9XCJjdXJyZW50VGllclwiIHRpZXJzPXt0aGlzLnN0YXRlLnRpZXJzfSB0aWVyPXt0aGlzLnN0YXRlLmN1cnJlbnRUaWVyfSBvbkNsaWNrPXt0aGlzLnNob3dOZXh0VGllcn0vPlxyXG5cdFx0XHRcdFx0XHRcdHtuZXh0fVxyXG5cdFx0XHRcdFx0XHQ8L2Rpdj5cclxuXHRcdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHRcdDwvZGl2PlxyXG5cdFx0XHQpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG5cclxuXHRSZWFjdERPTS5yZW5kZXIoXHJcblx0XHQvLyA8dWw+XHJcblx0XHQvLyBcdDxOYXZFbGUgbmFtZT1cImNhY2NvbmEgZ2lnYW50ZVwiLz5cclxuXHRcdC8vIDwvdWw+LFxyXG5cdFx0PE1lbnUganNvbj17YXBpVXJsfSAvPixcclxuXHRcdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtY29udGVudCcpXHJcblx0KVxyXG5cclxuXHJcblxyXG59KSgpO1xyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
